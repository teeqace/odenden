require=function e(t,n,i){function s(a,c){if(!n[a]){if(!t[a]){var h="function"==typeof require&&require;if(!c&&h)return h(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var r=n[a]={exports:{}};t[a][0].call(r.exports,function(e){var n=t[a][1][e];return s(n?n:e)},r,r.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}({ButtonEvent:[function(e,t,n){"use strict";cc._RF.push(t,"683fbpCSSRCro0c4XUJ+qde","ButtonEvent");var i=e("MessagePipeline");cc.Class({"extends":cc.Component,properties:{},onLoad:function(){},$callEvent:function(e,t){i.messagePipeline.sendMessage(t,this)}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],CountDown:[function(e,t,n){"use strict";cc._RF.push(t,"94e98UMozBEe5h3MRDNNZfy","CountDown");e("MessagePipeline");cc.Class({"extends":cc.Component,properties:{filler:cc.Sprite,labelText:cc.Label,effect:cc.Animation},onLoad:function(){this.time=0},countDown:function(e){this.time=e,this.time<=6&&this.time>0?this.node.x=0:this.node.x=1e3},update:function(e){if(!(this.time>6||this.time<=0)){var t=Math.floor(this.time),n=Number(this.labelText.string);t<n&&this.effect.play(),this.labelText.string=t,this.filler.fillRange=this.time-Math.floor(this.time)}}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],DisplayStats:[function(e,t,n){"use strict";cc._RF.push(t,"9ef27SBMkVJjZBP53cDb5Lt","DisplayStats"),cc.Class({"extends":cc.Component,properties:{displayStats:!0},onLoad:function(){cc.director.setDisplayStats(this.displayStats)}}),cc._RF.pop()},{}],GameLabel:[function(e,t,n){"use strict";cc._RF.push(t,"a2f1fv0Z+VFaa7mjfpXkqdo","GameLabel");var i=e("MessagePipeline");cc.Class({"extends":cc.Component,properties:{labelText:cc.Label},onLoad:function(){this._animation=this.getComponent(cc.Animation),this._labelType="",this._labelTimer=0,this._isOpened=!1,i.messagePipeline.on("GAME_OPEN",this._gameOpen,this),i.messagePipeline.on("GAME_OVER",this._gameOver,this)},_gameOpen:function(){this._animation.play("LabelOpen"),this._labelType="gameOpen",this._labelTimer=3},_gameOver:function(e,t){this.gameData=e.detail,this._animation.play("LabelOpen"),this._labelType="gameOver"},_labelOpened:function(){this._isOpened=!0},_labelClosed:function(){this._isOpened=!1},update:function(e){if(this._isOpened&&("gameOpen"===this._labelType&&(this._labelTimer-=e,this._labelTimer>0?this.labelText.string=Math.ceil(this._labelTimer):this._labelTimer>-1?this.labelText.string="START!":(this.labelText.string="",this._labelType="",this._animation.play("LabelClose"),i.messagePipeline.sendMessage("GAME_START",this))),"gameOver"===this._labelType)){var t=this.gameData.stageCount;this.labelText.string="TIME UP!\nODEN:"+(t-1)}}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],Game:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}cc._RF.push(t,"8d2a2Zbt3VOILwjGWslrEcA","Game");var s=e("Goal"),o=i(s),a=e("CountDown"),c=i(a),h=e("MessagePipeline"),u=3;cc.Class({"extends":cc.Component,properties:{goal:o["default"],countDown:c["default"],shukkaTimeAdd:cc.Animation,nextStageTimeAdd:cc.Animation,labelnextStageTime:cc.Label,labelOdn:cc.Label,labelStage:cc.Label,labelTime:cc.Label,timer:15},onLoad:function(){this.stageCount=0,this.taneCount=u,this.openTimer=0,this.targetOdnCount=0,this.gameStart=!1,h.messagePipeline.on("STAGE_CLEAR",this._nextStage,this),h.messagePipeline.on("UNIT_SHUKKA",this._shukka,this),h.messagePipeline.on("GAME_START",this._gameStart,this)},_nextStage:function(){if(this.stageCount>0){var e=Math.floor((this.stageCount-1)/3);e>0&&(this.labelnextStageTime.string="+"+e+"sec",this.nextStageTimeAdd.play(),this.timer=Math.min(30,this.timer+e))}this.stageCount+=1,this.taneCount=u+(this.stageCount-1)%u,this.targetOdnCount=1+Math.floor((this.stageCount-1)/u),this.labelOdn.string="ODEN:"+(this.stageCount-1),this.labelStage.string="STAGE:"+(Math.floor((this.stageCount-1)/u)+1)+"-"+((this.stageCount-1)%u+1),h.messagePipeline.sendMessage("NEXT_STAGE",this)},_shukka:function(){this.targetOdnCount-=1,this.timer=Math.min(30,this.timer+1),this.shukkaTimeAdd.play(),this.labelOdn.string="ODEN:"+(this.stageCount-1)},_gameStart:function(){this.gameStart=!0},update:function(e){this.openTimer<1&&(this.openTimer+=e,this.openTimer>=1&&(h.messagePipeline.sendMessage("GAME_OPEN",this),this._nextStage())),this.gameStart&&(this.timer=Math.max(0,this.timer-e),this.labelTime.string="TIME:"+Math.floor(10*this.timer)/10,this.countDown.countDown(this.timer),this.timer<=0&&(this.gameStart=!1,h.messagePipeline.sendMessage("GAME_OVER",this)))}}),cc._RF.pop()},{CountDown:"CountDown",Goal:"Goal",MessagePipeline:"MessagePipeline"}],Goal:[function(e,t,n){"use strict";cc._RF.push(t,"49534CdsJ9Lm4nswWRnxJqq","Goal");var i=e("MessagePipeline"),s=128;cc.Class({"extends":cc.Component,properties:{tanes:{"default":[],type:[cc.Node]}},onLoad:function(){i.messagePipeline.on("NEXT_STAGE",this._nextStage,this)},_nextStage:function(e,t){for(var n=e.getUserData(),i=n.taneCount,o=s/2*(i-1),a=0;a<i;a++)this.tanes[a].x=o-s*a;for(var c=i;c<this.tanes.length;c++)this.tanes[c].x=1e3}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],MessagePipeline:[function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}cc._RF.push(t,"5b16bYPmIRKNayaswZYtCnn","MessagePipeline"),Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),c=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,[{key:"sendMessage",value:function(e,t){cc.log("dispatch system notification "+e),this.emit(e,t)}}]),t}(cc.EventTarget);n.messagePipeline=new c;cc._RF.pop()},{}],Mochi:[function(e,t,n){"use strict";cc._RF.push(t,"c8b96VRd6FDm5LsyllTzY43","Mochi"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){this.targetX=this.node.position.x},update:function(e){var t=this.targetX-this.node.x;this.node.x+=t*(2*e)},setTarget:function(e){this.targetX=e}}),cc._RF.pop()},{}],SwapButtons:[function(e,t,n){"use strict";cc._RF.push(t,"77655nyCIhHdLdfr+PrZbqS","SwapButtons");var i=e("MessagePipeline"),s=600;cc.Class({"extends":cc.Component,properties:{buttons:{"default":[],type:[cc.Node]}},onLoad:function(){i.messagePipeline.on("NEXT_STAGE",this._nextStage,this)},_nextStage:function(e,t){for(var n=e.getUserData(),i=n.taneCount,o=i-1,a=s/o,c=a/2*(o-1),h=0;h<this.buttons.length;h++)h<o?this.buttons[h].width=a:this.buttons[h].width=0,this.buttons[h].x=c-a*h}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],SwapButton:[function(e,t,n){"use strict";cc._RF.push(t,"a5561xrYvlC/IbnI3VFQOMx","SwapButton");var i=e("MessagePipeline");cc.Class({"extends":cc.Component,properties:{},onLoad:function(){},$swap:function(e,t){var n=Number(t);i.messagePipeline.sendMessage("TANE_SWAP",n)}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],SwapSigns:[function(e,t,n){"use strict";cc._RF.push(t,"a61e0xmykhHp7UlBAtEOLYr","SwapSigns");var i=e("MessagePipeline"),s=128;cc.Class({"extends":cc.Component,properties:{signs:{"default":[],type:[cc.Node]}},onLoad:function(){i.messagePipeline.on("NEXT_STAGE",this._nextStage,this)},_nextStage:function(e,t){for(var n=e.getUserData(),i=n.taneCount,o=i-1,a=s/2*(o-1),c=0;c<this.signs.length;c++)c<o?this.signs[c].x=a-s*c:this.signs[c].x=1e3}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],TouchBlocker:[function(e,t,n){"use strict";cc._RF.push(t,"5ebc4+xulRCWKqdh5HX6QQo","TouchBlocker");var i=e("MessagePipeline");cc.Class({"extends":cc.Component,onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){e.stopPropagation()},this.node),i.messagePipeline.on("GAME_OPEN",this._blockOn,this),i.messagePipeline.on("GAME_START",this._blockOff,this),i.messagePipeline.on("GAME_OVER",this._blockOn,this)},_blockOff:function(){this.node.setScale(0)},_blockOn:function(){this.node.setScale(1)}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],TouchInput:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}cc._RF.push(t,"ebbbaGZgelHMo+XOSruDJ7R","TouchInput");var s=e("Mochi"),o=i(s);cc.Class({"extends":cc.Component,properties:{mochi:o["default"]},_onTouchBegan:function(e){var t=e.getLocation();cc.log("_onTouchBegan"),this._mochiMove(t),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this._touched=!0},_finishTouch:function(e){if(this._touched){this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this._touched=!1;e.getLocation();cc.log("_finishTouch")}},_onTouchEnded:function(e){this._finishTouch(e),cc.log("_onTouchEnded")},_onTouchCancel:function(e){this._finishTouch(e),cc.log("_onTouchCancel")},_onTouchMove:function(e){var t=e.getLocation();this._mochiMove(t)},onLoad:function(){this._touched=!1,this._registerEvent()},onDestroy:function(){this._unregisterEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this)},_mochiMove:function(e){var t=this.node.parent.convertToNodeSpaceAR(e);cc.log(t),this.mochi.setTarget(t.x)}}),cc._RF.pop()},{Mochi:"Mochi"}],Units:[function(e,t,n){"use strict";cc._RF.push(t,"e6f67GSqFdKfoNZ+CuamO88","Units");var i=e("MessagePipeline"),s=3,o=70;cc.Class({"extends":cc.Component,properties:{unitPrefab:cc.Prefab},onLoad:function(){i.messagePipeline.on("NEXT_STAGE",this._nextStage,this),i.messagePipeline.on("TANE_SWAP",this._taneSwap,this),this.taneCount=0,this.targetOdnCount=0,this.restOdnCount=0},_nextStage:function(e,t){var n=e.getUserData();this.taneCount=n.taneCount,this.targetOdnCount=n.targetOdnCount;for(var i=Math.min(s,this.targetOdnCount),o=0;o<i;o++)this.newUnit(o+1);this.restOdnCount=Math.max(0,this.targetOdnCount-i)},_shukka:function(){this.node.getComponentsInChildren("Unit").forEach(function(e){e.fall()},this);var e=this.node.children.length;i.messagePipeline.sendMessage("UNIT_SHUKKA",this),this.restOdnCount>0&&e<=s?(this.newUnit(e),this.restOdnCount-=1):0===this.restOdnCount&&e<=1&&i.messagePipeline.sendMessage("STAGE_CLEAR",this)},_taneSwap:function(e,t){var n=e.getUserData();this.node.getComponentsInChildren("Unit").forEach(function(e){0===e.unitIndex&&e.swap(n)},this)},newUnit:function(e){var t=cc.instantiate(this.unitPrefab);t.parent=this.node,t.y=o*(s+1),t.on("shukka",this._shukka,this);var n=t.getComponent("Unit");n.stack(e,this.taneCount)},update:function(e){}}),cc._RF.pop()},{MessagePipeline:"MessagePipeline"}],Unit:[function(e,t,n){"use strict";cc._RF.push(t,"c7f8fir1OBJs59UJ0QUffgl","Unit");var i=128,s=["kon","dai","chiku","naru","han"];cc.Class({"extends":cc.Component,properties:{tanes:{"default":[],type:[cc.Node]}},onLoad:function(){this.animation=this.node.getComponent(cc.Animation),this.stacked=!1,this.unitIndex=0,this.taneCount=0,this.isOnSwapping=!1,this.isOnShukkaing=!1,this.moveToRight=cc.moveBy(.1,i,0),this.moveToLeft=cc.sequence(cc.moveBy(.1,-i,0),cc.callFunc(function(){this.isOnSwapping=!1,this.unitCheck()},this))},stack:function(e,t){this.stacked=!0,this.unitIndex=e,this.taneCount=t;for(var n=0;n<this.tanes.length;n++)s.indexOf(this.tanes[n].name)<this.taneCount?this.tanes[n].active=!0:this.tanes[n].active=!1;for(this.shuffle();this.isCorrect();)this.shuffle();for(var o=i/2*(this.taneCount-1),a=0;a<this.tanes.length;a++)this.tanes[a].active&&(this.tanes[a].x=o-i*this.tanes[a].lane);this.fall()},fall:function(){this.unitIndex=Math.max(0,this.unitIndex-1),this.animation.play("fall"+this.unitIndex)},shuffle:function(){for(var e,t,n=this.tanes.length;n;)t=Math.floor(Math.random()*n--),e=this.tanes[n],this.tanes[n]=this.tanes[t],this.tanes[t]=e;this.resetLane()},isCorrect:function(){for(var e=0;e<this.tanes.length;e++)if(this.tanes[e].active&&this.tanes[e].lane!==s.indexOf(this.tanes[e].name))return!1;return!0},resetLane:function(){for(var e=0,t=0;t<this.tanes.length;t++)this.tanes[t].active?(this.tanes[t].lane=e,e+=1):this.tanes[t].lane=-1},unitCheck:function(){this.isCorrect()&&(this.isOnShukkaing=!0,this.animation.play("shukka"+this.taneCount))},shukka:function(){this.node.emit("shukka",this),this.node.destroy()},swap:function(e){if(!this.isOnSwapping&&!this.isOnShukkaing){this.isOnSwapping=!0;var t=this.getTaneByLane(e),n=this.getTaneByLane(e-1);t.lane-=1,n.lane+=1,t.runAction(this.moveToRight),n.runAction(this.moveToLeft)}},getTaneByLane:function(e){for(var t=0;t<this.tanes.length;t++)if(this.tanes[t].lane===e)return this.tanes[t];return null},update:function(e){this.stacked&&(this.node.zIndex=100-this.unitIndex)}}),cc._RF.pop()},{}]},{},["Mochi","TouchInput","DisplayStats","MessagePipeline","ButtonEvent","CountDown","Game","GameLabel","Goal","SwapButton","SwapButtons","SwapSigns","TouchBlocker","Unit","Units"]);